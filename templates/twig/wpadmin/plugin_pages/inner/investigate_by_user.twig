{% extends '/wpadmin/plugin_pages/base_inner_page.twig' %}

{% block inner_page_body %}
	{% include '/wpadmin/components/investigate/lookup_strip.twig' with {
		action: hrefs.by_user,
		lookup_route: vars.lookup_route,
		label: strings.lookup_label,
		input_name: 'user_lookup',
		input_type: 'text',
		input_value: vars.user_lookup|default(''),
		placeholder: strings.lookup_placeholder,
		submit_text: strings.lookup_submit
	} only %}

	{% if not flags.has_subject %}
		<div class="alert alert-warning mb-0">
			<strong>{{ flags.subject_not_found ? strings.not_found_title : strings.no_subject_title }}</strong>
			<div>{{ flags.subject_not_found ? strings.not_found_text : strings.no_subject_text }}</div>
		</div>
	{% else %}
		<div class="options_form_for--modern">
			<div class="shield-options-layout has-rail">
				<aside class="shield-options-rail">
					<div class="shield-options-rail-accent"></div>
					{% include '/components/config/options_rail_tabs.twig' with {
						nav_id: 'ShieldInvestigateByUserTabsNav',
						nav_items: vars.rail_nav_items
					} only %}
				</aside>

				<div class="shield-options-content">
					<div class="tab-content investigate-by-user-content">
						<section class="tab-pane shield-options-panel active show"
								 id="tabInvestigateUserOverview"
								 role="tabpanel"
								 aria-labelledby="tab-navlink-user-overview">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/overview_table.twig' with {
									title: strings.overview_title,
									rows: vars.overview_rows
								} only %}
							</div>
						</section>
						<section class="tab-pane shield-options-panel"
								 id="tabInvestigateUserSessions"
								 role="tabpanel"
								 aria-labelledby="tab-navlink-user-sessions">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/table_container.twig' with {
									table: vars.tables.sessions
								} only %}
							</div>
						</section>
						<section class="tab-pane shield-options-panel"
								 id="tabInvestigateUserActivity"
								 role="tabpanel"
								 aria-labelledby="tab-navlink-user-activity">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/table_container.twig' with {
									table: vars.tables.activity
								} only %}
							</div>
						</section>
						<section class="tab-pane shield-options-panel"
								 id="tabInvestigateUserRequests"
								 role="tabpanel"
								 aria-labelledby="tab-navlink-user-requests">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/table_container.twig' with {
									table: vars.tables.requests
								} only %}
							</div>
						</section>
						<section class="tab-pane shield-options-panel"
								 id="tabInvestigateUserIps"
								 role="tabpanel"
								 aria-labelledby="tab-navlink-user-ips">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								<div class="card shield-card status-good">
									<div class="shield-card-accent status-good"></div>
									<div class="card-body">
										<h5 class="card-title mb-3">{{ strings.related_ips_title }}</h5>
										{% if vars.related_ips is empty %}
											<p class="mb-0">{{ strings.related_ips_empty }}</p>
										{% else %}
											<div class="row g-3">
												{% for related in vars.related_ips %}
													<div class="col-12 col-md-6 col-xl-4">
														<div class="card shield-card h-100 investigate-by-user-ip-card status-{{ related.status|default('info') }}">
															<div class="shield-card-accent status-{{ related.status|default('info') }}"></div>
															<div class="card-body d-flex flex-column gap-2">
																<div class="d-flex justify-content-between align-items-start gap-2">
																	<a href="{{ related.href }}"
																	   class="offcanvas_ip_analysis ip-address fw-semibold"
																	   data-ip="{{ related.ip }}">{{ related.ip }}</a>
																	<span class="shield-badge badge-{{ related.status|default('info') }} status-{{ related.status|default('info') }} investigate-by-user-ip-status">{{ related.status_label|default('') }}</span>
																</div>
																{% if related.investigate_href|default('') is not empty %}
																	<div>
																		<a href="{{ related.investigate_href }}" class="btn btn-outline-secondary btn-sm">Investigate IP</a>
																	</div>
																{% endif %}
																<div>
																	<div>{{ related.last_seen_ago|default('-') }}</div>
																	{% if related.last_seen_at|default('') is not empty %}
																		<div class="timestamp-small">{{ related.last_seen_at }}</div>
																	{% endif %}
																</div>
																<div class="small text-muted investigate-by-user-ip-counts">
																	Sessions: {{ related.sessions_count|default(0) }} |
																	Activity: {{ related.activity_count|default(0) }} |
																	Requests: {{ related.requests_count|default(0) }}
																</div>
															</div>
														</div>
													</div>
												{% endfor %}
											</div>
										{% endif %}
									</div>
								</div>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}
