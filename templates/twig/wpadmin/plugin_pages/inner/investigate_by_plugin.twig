{% extends '/wpadmin/plugin_pages/base_inner_page.twig' %}

{% block inner_page_body %}
	<div class="card shield-card mb-3">
		<div class="shield-card-accent status-info"></div>
		<div class="card-body">
			<form method="get" action="{{ hrefs.by_plugin }}" class="row g-2 align-items-end">
				<input type="hidden" name="page" value="{{ vars.lookup_route.page|default('') }}" />
				<input type="hidden" name="nav" value="{{ vars.lookup_route.nav|default('') }}" />
				<input type="hidden" name="nav_sub" value="{{ vars.lookup_route.nav_sub|default('') }}" />
				<div class="col-12 col-lg-8">
					<label class="form-label mb-1">{{ strings.lookup_label }}</label>
					<select name="plugin_slug" class="form-select">
						<option value="">{{ strings.lookup_placeholder }}</option>
						{% for option in vars.plugin_options|default([]) %}
							<option value="{{ option.value }}" {{ vars.plugin_slug == option.value ? 'selected' : '' }}>
								{{ option.label }}
							</option>
						{% endfor %}
					</select>
				</div>
				<div class="col-12 col-lg-4 d-flex gap-2">
					<button type="submit" class="btn btn-outline-primary">{{ strings.lookup_submit }}</button>
					<a href="{{ hrefs.back_to_investigate }}" class="btn btn-outline-secondary">{{ strings.back_to_investigate }}</a>
				</div>
			</form>
		</div>
	</div>

	{% if not flags.has_subject %}
		<div class="card shield-card">
			<div class="shield-card-accent status-warning"></div>
			<div class="card-body">
				{% if flags.subject_not_found %}
					<h5 class="card-title mb-2">{{ strings.not_found_title }}</h5>
					<p class="mb-0">{{ strings.not_found_text }}</p>
				{% else %}
					<h5 class="card-title mb-2">{{ strings.no_subject_title }}</h5>
					<p class="mb-0">{{ strings.no_subject_text }}</p>
				{% endif %}
			</div>
		</div>
	{% else %}
		<div class="options_form_for--modern">
			<div class="shield-options-layout has-rail">
				<aside class="shield-options-rail">
					<div class="shield-options-rail-accent"></div>
					{% include '/components/config/options_rail_tabs.twig' with {
						nav_id: 'ShieldInvestigateByPluginTabsNav',
						nav_items: vars.rail_nav_items
					} only %}
				</aside>

				<div class="shield-options-content">
					<div class="tab-content">
						<section class="tab-pane shield-options-panel active show"
								 id="{{ vars.tabs.overview.pane_id }}"
								 role="tabpanel"
								 aria-labelledby="{{ vars.tabs.overview.nav_id }}">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/subject_header.twig' with {
									subject: vars.subject
								} only %}

								<div class="row g-2 mb-3">
									{% for stat in vars.summary %}
										<div class="col-6 col-xl-3">
											<div class="card shield-card h-100">
												<div class="shield-card-accent status-{{ stat.status|default('info') }}"></div>
												<div class="card-body py-3">
													<div class="h4 mb-1">{{ stat.count|default(0) }}</div>
													<div class="text-muted small">{{ stat.label|default('') }}</div>
												</div>
											</div>
										</div>
									{% endfor %}
								</div>

								<div class="card shield-card status-info">
									<div class="shield-card-accent status-info"></div>
									<div class="card-body">
										<h5 class="card-title mb-3">{{ strings.overview_title }}</h5>
										<div class="table-responsive">
											<table class="table table-sm">
												<tbody>
												{% for row in vars.overview_rows|default([]) %}
													<tr>
														<th class="w-25">{{ row.label }}</th>
														<td>
															{% if row.value_href|default('') is not empty %}
																<a href="{{ row.value_href }}" target="_blank">{{ row.value|default('') }}</a>
															{% else %}
																{{ row.value|default('') }}
															{% endif %}
														</td>
													</tr>
												{% endfor %}
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</section>

						<section class="tab-pane shield-options-panel"
								 id="{{ vars.tabs.file_status.pane_id }}"
								 role="tabpanel"
								 aria-labelledby="{{ vars.tabs.file_status.nav_id }}">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/table_container.twig' with {
									table: vars.tables.file_status
								} only %}
							</div>
						</section>

						<section class="tab-pane shield-options-panel"
								 id="{{ vars.tabs.vulnerabilities.pane_id }}"
								 role="tabpanel"
								 aria-labelledby="{{ vars.tabs.vulnerabilities.nav_id }}">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								<div class="card shield-card status-{{ vars.vulnerabilities.status|default('info') }}">
									<div class="shield-card-accent status-{{ vars.vulnerabilities.status|default('info') }}"></div>
									<div class="card-body">
										<div class="d-flex justify-content-between align-items-start gap-2">
											<div>
												<h5 class="card-title mb-2">{{ vars.vulnerabilities.title|default('') }}</h5>
												<p class="mb-0">{{ vars.vulnerabilities.summary|default('') }}</p>
											</div>
											{% if vars.vulnerabilities.lookup_href|default('') is not empty %}
												<a href="{{ vars.vulnerabilities.lookup_href }}" target="_blank" class="btn btn-outline-secondary btn-sm">{{ vars.vulnerabilities.lookup_text|default('Lookup') }}</a>
											{% endif %}
										</div>
									</div>
								</div>
							</div>
						</section>

						<section class="tab-pane shield-options-panel"
								 id="{{ vars.tabs.activity.pane_id }}"
								 role="tabpanel"
								 aria-labelledby="{{ vars.tabs.activity.nav_id }}">
							<div class="shield-options-panel-accent"></div>
							<div class="shield-options-panel-body">
								{% include '/wpadmin/components/investigate/table_container.twig' with {
									table: vars.tables.activity
								} only %}
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}
