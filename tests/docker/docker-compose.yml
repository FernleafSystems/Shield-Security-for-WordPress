# Docker Compose for Shield Security testing
# Based on Easy Digital Downloads docker-compose-phpunit.yml pattern
services:
  mysql:
    image: mariadb:10.2
    environment:
      MYSQL_ROOT_PASSWORD: ''
      MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
      MYSQL_DATABASE: wordpress_test
    volumes:
      - mysql_data:/var/lib/mysql

  test-runner:
    build:
      context: .
      args:
        PHP_VERSION: ${PHP_VERSION:-8.2}
        WP_VERSION: ${WP_VERSION:-6.4}
    depends_on:
      - mysql
    volumes:
      - ../../:/app
    working_dir: /app
    environment:
      TEST_PHP_VERSION: ${PHP_VERSION:-8.2}
      TEST_WP_VERSION: ${WP_VERSION:-6.4}
      SHIELD_PACKAGE_PATH: ${SHIELD_PACKAGE_PATH}
      PLUGIN_SOURCE: ${PLUGIN_SOURCE}
    command: bin/run-tests-docker.sh wordpress_test root '' mysql ${WP_VERSION:-6.4}

volumes:
  mysql_data: