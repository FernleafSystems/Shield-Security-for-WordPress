# Repository Guidelines

## Product Snapshot
Shield Security is an enterprise-grade WordPress plugin delivering defense-in-depth protection through eight coordinated security modules (Security Admin, Firewall, Login Guard, IPs, HackGuard, Comments Filter, Audit Trail, Traffic). It targets security-conscious site owners, agencies, and MSPs who need scalable protection, compliance-ready auditing, and integrations with MainWP, WP-CLI, and threat-intel services such as CrowdSec and Have I Been Pwned.

## Project Structure
Core PHP lives in `src/`, organised by module (for example `Modules/Login_Protect`, `Rules`, `Controller`). Prefixed third-party libraries generated by Strauss reside in `vendor_prefixed/`. Asset sources are under `assets/` (webpack entry points in `assets/js/app` and `assets/scss`), with compiled bundles emitted to `assets/dist`. WordPress bootstrap files (`icwp-wpsf.php`, `plugin_init.php`, `plugin.json`) wire modules and option schemas. Tests sit in `tests/` with `Unit/`, `Integration/`, Docker harness, fixtures, and smoke-test playbooks.

## Build, Test & Verification
- `npm install && npm run build` – install and compile production assets (required before packaging).
- `npm run dev` – watch-mode compilation for UI work.
- `composer install` – resolve dependencies.
- `./bin/run-docker-tests.sh` – quickest path to CI-equivalent validation (PHP 7.4–8.x, latest WP).
- `composer test`, `composer test:unit`, `composer test:integration` – run PHPUnit suites locally; add `--filter ClassName` when iterating.
- `composer phpcs` / `composer phpcs:fix` – enforce WordPress Coding Standards prior to PRs.

## Coding Standards & Naming
All PHP files declare strict types, follow PSR-4 namespaces rooted at `FernleafSystems\Wordpress\Plugin\Shield`, and use tabs for indentation. Classes are PascalCase, services lean on trait-based dependency injection (e.g., `PluginControllerConsumer`), and WordPress option keys/hooks stay snake_case. Twig templates in `templates/twig` must escape output; JavaScript modules under `assets/js` use ES6 modules, camelCase exports, and lint via webpack build output.

## Testing Practices
Unit tests live in `tests/Unit/*Test.php` using Brain Monkey for WP mocks; integration tests under `tests/Integration` bootstrap full WordPress (see `tests/bootstrap`). Package validation scripts confirm prefixed dependencies stay intact—run them when touching build tooling. Update fixtures in `tests/fixtures` whenever configuration changes affect serialized data.

## Commit & PR Workflow
Write imperative, present-tense commit subjects under 72 characters; expand motivation in the body when touching security-sensitive code. Reference issues with `GH-###` and document security impacts in `changelog.md` when behaviour changes. PRs should summarise scope, list automated/manual test evidence, and include before/after media for admin UI tweaks or user-facing flows.

## Security & Operational Notes
Never commit credentials, license keys, or customer data. Coordinate changes to authentication, rate limiting, or logging modules with the product specs in `.agent-os/`. When altering CrowdSec, 2FA, or package build processes, cross-check `.agent-os/specs/` and update any spec status or verification protocols. Ensure production builds run `composer package-plugin` (via `bin/package-plugin.php`, supersedes deprecated `bin/build-package.sh`) so prefixed libraries and strict asset versions ship correctly.
